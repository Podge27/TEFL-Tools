<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom Grammar Tool</title>
    <style>
        /* --- 1. CORE THEME --- */
        :root {
            --bg-paper: #FFFDF5;
            --text-main: #2D3748;
            --btn-blue: #4299E1;
            --btn-blue-dark: #2B6CB0;
            --btn-teal: #38B2AC;
            --btn-teal-dark: #2C7A7B;
            --btn-orange: #ED8936;
            --btn-orange-dark: #C05621;
            --gap-line: #4A5568;
            --gap-text: #2F855A;
        }

        body { 
            font-family: 'Verdana', 'Segoe UI', sans-serif; 
            margin: 0; 
            color: var(--text-main); 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            background: var(--bg-paper);
            overflow: hidden;
        }

        /* --- 2. HEADER --- */
        header { 
            background: #E2E8F0; 
            height: 70px; 
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: flex-start; 
            gap: 15px; 
            padding: 0 20px;
            border-bottom: 3px solid #CBD5E0;
            z-index: 20;
        }

        .nav-btn {
            background: white; color: var(--text-main);
            border: 2px solid #CBD5E0; border-bottom: 4px solid #CBD5E0;
            font-weight: bold; padding: 8px 15px; border-radius: 8px;
            cursor: pointer; font-size: 0.95rem;
            display: flex; align-items: center; gap: 8px; transition: all 0.1s;
        }
        .nav-btn:active { transform: translateY(2px); border-bottom: 2px solid #CBD5E0; }
        
        #sidebar-toggle { background: var(--btn-orange); color: white; border-color: var(--btn-orange-dark); border-bottom-color: var(--btn-orange-dark); }
        #header-title { font-size: 1.4rem; color: var(--text-main); font-weight: 700; margin-left: 10px; }

        /* --- 3. LAYOUT & SIDEBAR --- */
        .main-container { 
            display: flex; 
            flex: 1; 
            overflow: hidden; 
            position: relative; 
            height: calc(100vh - 70px);
        }
        
        #sidebar { 
            width: 260px; 
            background: #2D3748; 
            color: white;
            display: flex;
            flex-direction: column;
            padding: 20px; 
            transition: margin-left 0.3s;
            flex-shrink: 0;
            border-right: 5px solid #1A202C;
            overflow-y: auto; 
            height: 100%; 
            box-sizing: border-box;
        }
        #sidebar::-webkit-scrollbar { width: 8px; }
        #sidebar::-webkit-scrollbar-track { background: #2D3748; }
        #sidebar::-webkit-scrollbar-thumb { background: #4A5568; border-radius: 4px; }

        #sidebar.collapsed { margin-left: -310px; }

        #stage { 
            flex: 1; 
            padding: 40px; 
            overflow-y: auto; 
            background: var(--bg-paper); 
            display: flex;
            flex-direction: column;
        }

        /* --- 4. BUTTONS & GRID --- */
        .fun-btn { 
            background: var(--btn-teal); color: white; border: none;
            border-bottom: 6px solid var(--btn-teal-dark); 
            padding: 20px; font-size: 1.3rem; font-weight: bold;
            cursor: pointer; border-radius: 15px; transition: all 0.1s;
            text-align: center;
        }
        .fun-btn:hover { filter: brightness(110%); transform: translateY(-2px); }
        .fun-btn:active { transform: translateY(4px); border-bottom: 2px solid var(--btn-teal-dark); }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px; }

        .resource-btn {
            width: 100%; background: #4A5568; color: white; border: none;
            border-bottom: 4px solid #2D3748; padding: 15px; text-align: left;
            font-size: 1.1rem; cursor: pointer; margin-bottom: 12px;
            border-radius: 10px; transition: 0.1s;
        }
        .resource-btn:hover { background: #718096; }
        .resource-btn.active { 
            background: var(--btn-blue); border-bottom-color: var(--btn-blue-dark);
            transform: translateX(5px);
        }

        /* --- 5. CONTENT STYLING --- */
        .hidden { display: none !important; }
        #menu-view { max-width: 900px; margin: 0 auto; width: 100%; text-align: center; }
        h1 { font-size: 2.5rem; color: var(--text-main); margin-bottom: 10px; }
        p.subtitle { color: #718096; font-size: 1.2rem; }

        /* SENTENCES */
        .sentence-list { list-style: none; padding: 0; text-align: center; margin-top: 40px; }
        .sentence-list li { 
            font-size: 3rem; margin-bottom: 50px; color: var(--text-main); 
            background: white; padding: 20px; border-radius: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 2px solid #E2E8F0;
        }

        /* GAP FILLS */
        .gap-container { 
            font-size: 2.5rem; line-height: 2.5; max-width: 950px; 
            margin: 40px auto; text-align: center; 
        }
        .gap-item { margin-bottom: 60px; }
        .gap-box {
            display: inline-block; min-width: 150px; padding: 0 10px; padding-bottom: 2px;
            border-bottom: 4px dashed var(--gap-line); color: transparent;
            cursor: pointer; transition: 0.2s; margin: 0 10px;
            user-select: none; vertical-align: baseline;
        }
        .gap-box::before { content: '\00a0'; }
        .gap-box:hover { background: #E2E8F0; border-radius: 5px; }
        .gap-box.revealed { 
            color: var(--gap-text); border-bottom: 4px solid var(--gap-text);
            font-weight: 800;
        }

        /* --- 6. HIGHLIGHTER CSS (FIXED: STEALTH MODE) --- */
        .highlight-word {
            cursor: pointer;
            /* Changed from solid #ccc to transparent so it's invisible initially */
            border-bottom: 2px solid transparent;
            padding: 0 2px;
            transition: all 0.2s;
            border-radius: 3px;
        }
        /* Subtle hover effect to show it's interactable */
        .highlight-word:hover { background-color: #e2e8f0; }
        
        /* The REVEALED state */
        .highlight-word.active {
            background-color: #F6E05E; /* Gold/Yellow */
            border-bottom: 2px solid #D69E2E;
            color: black;
            font-weight: bold;
        }

    </style>
</head>
<body>

    <header>
        <button id="sidebar-toggle" class="nav-btn hidden" onclick="toggleSidebar()"><span>‚ò∞</span> Menu</button>
        <button id="header-back-btn" class="nav-btn" onclick="handleBackClick()"><span>‚Ü©</span> Back</button>
        <div id="header-title">Grammar Playground</div>
    </header>

    <div class="main-container">
        
        <aside id="sidebar" class="hidden">
            <h3 style="color: #A0AEC0; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px;">Tools</h3>
            <div id="resource-buttons"></div>
        </aside>

        <main id="stage">
            
            <div id="menu-view">
                <div id="level-selection">
                    <h1>Grammar Levels</h1>
                    <p class="subtitle">Choose a level to start</p>
                    <div id="level-list" class="grid"></div>
                </div>

                <div id="topic-selection" class="hidden">
                    <h1><span id="selected-level-name" style="color: var(--btn-teal);"></span> Topics</h1>
                    <p class="subtitle">Pick a lesson</p>
                    <div id="topic-list" class="grid"></div>
                </div>
            </div>

            <div id="content-view" class="hidden">
                <div id="intro-message" style="text-align: center; color: #A0AEC0; margin-top: 100px;">
                    <h2 style="font-size: 2.5rem; opacity: 0.5;">Select an activity üëà</h2>
                </div>
                <div id="lesson-content"></div>
            </div>

        </main>
    </div>

    <script>
        // --- 1. THE DATA ---
        const grammarData = [
          {
            "level": "A1",
            "topic": "Present Simple: To Be",
            "slug": "a1-to-be",
            "description": "Using am, is, and are.",
            "resources": {
              "sentences": ["I am from Italy.", "He is a doctor."],
              "gapfill": [{ "q": "They ___ at the park.", "a": "are" }],
              "visual": "https://via.placeholder.com/800x600?text=Cartoon+Cat"
            }
          },
          {
            "level": "B2",
            "topic": "Past Modals: Speculation & Regret",
            "slug": "b2-past-modals",
            "description": "Talking about past mistakes, possibilities, and deductions.",
            "resources": {
              // Note: The class highlight-word is used, but CSS hides it until clicked
              "reading_highlight": "<div style='font-size: 1.5rem; line-height: 2;'><h3>The 2022 World Cup Final</h3><p>It was one of the greatest games in history. Argentina <span class='highlight-word' onclick='this.classList.toggle(\"active\")'>must have felt</span> confident leading 2-0. France <span class='highlight-word' onclick='this.classList.toggle(\"active\")'>could have given up</span>, but Mbapp√© scored twice. Many fans thought Argentina <span class='highlight-word' onclick='this.classList.toggle(\"active\")'>might have lost</span> their chance. In the end, Messi <span class='highlight-word' onclick='this.classList.toggle(\"active\")'>must have been</span> relieved to finally lift the trophy. The French defenders <span class='highlight-word' onclick='this.classList.toggle(\"active\")'>shouldn't have let</span> Di Maria score that first goal!</p><p style='font-size:1rem; color:#666;'>(Click the past modals to highlight them)</p></div>",
              
              "video_task": "<div style='text-align:center'><video controls width='100%' style='border-radius:15px; max-height:500px;'><source src='assets/Coffee_Machine_Explosion_Video_Generated.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div>",
              
              "video_gapfill": [
                { "q": "He ___ the note. (advice)", "a": "should have read" },
                { "q": "He ___ the button. (regret)", "a": "shouldn't have pressed" },
                { "q": "The machine ___ working that day. (deduction)", "a": "must have stopped" },
                { "q": "The cup ___ ! (surprise)", "a": "shouldn't have disappeared" }
              ],

              "structure": "<div style='text-align:center; font-size: 1.8rem;'><div style='background:white; padding:20px; border-radius:15px; border:2px solid #CBD5E0; display:inline-block;'><strong>MODAL VERB</strong> + <span style='color:#D69E2E'>HAVE</span> + <strong>PAST PARTICIPLE</strong></div><br><br><p><em>She <strong>must</strong> <span style='color:#D69E2E'>have</span> <strong>forgotten</strong> her keys.</em></p></div>",

              "probability_scale": "<ul style='list-style:none; padding:0; font-size:1.4rem;'><li style='margin-bottom:20px; border-left: 5px solid #38A169; padding-left:15px;'><strong>90-100% (Certainty)</strong><br>Must have / Can't have</li><li style='margin-bottom:20px; border-left: 5px solid #D69E2E; padding-left:15px;'><strong>50% (Possibility)</strong><br>Could have / May have / Might have</li></ul>",

              "alternatives": "<ul style='font-size:1.5rem;'><li><strong>Supposed to have</strong> (Plan failed)<br><em>'The train was supposed to have arrived.'</em></li><br><li><strong>Needed to have</strong> (Necessary)<br><em>'You needed to have submitted the form.'</em></li></ul>",

              "practice_gaps": [
                { "q": "The streets are wet. It ___ (rain).", "a": "must have rained" },
                { "q": "She walked past me! She ___ (see) me.", "a": "can't have seen" }
              ],

              "speaking": "<ul style='font-size:1.6rem; line-height:1.6;'><li>Tell me about a time you made a mistake. What <strong>should you have done</strong> differently?</li><li>Think of a time you were late. What <strong>might have happened</strong> if you had arrived on time?</li></ul>",

              "pronunciation": "<div style='text-align:center; font-size:1.5rem;'><h3>The Weak 'Have' (/…ôv/)</h3><p>When we speak quickly, 'have' is NOT stressed.</p><div style='font-size:2rem;'>Must have ‚ûù <strong>Must'av</strong></div><div style='font-size:2rem;'>Should have ‚ûù <strong>Should'av</strong></div></div>",

              "cartoon_visual": "assets/pastmodalcartoon.png"
            }
          }
        ];

        let currentView = 'levels'; 
        let currentLevel = '';

        document.addEventListener('DOMContentLoaded', () => { renderLevels(); updateHeader(); });

        // --- NAVIGATION ---
        function handleBackClick() {
            if (currentView === 'levels') window.location.href = 'index.html'; 
            else if (currentView === 'topics') renderLevels();
            else if (currentView === 'content') renderTopics(currentLevel);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function updateHeader() {
            const btn = document.getElementById('header-back-btn');
            const title = document.getElementById('header-title');
            const toggle = document.getElementById('sidebar-toggle');
            
            if (currentView === 'levels') {
                btn.innerHTML = '<span>‚úï</span> Exit'; title.innerText = 'Grammar Playground';
                toggle.classList.add('hidden'); document.getElementById('sidebar').classList.add('hidden');
            } else if (currentView === 'topics') {
                btn.innerHTML = '<span>‚Ü©</span> Levels'; title.innerText = currentLevel;
                toggle.classList.add('hidden'); document.getElementById('sidebar').classList.add('hidden');
            } else if (currentView === 'content') {
                btn.innerHTML = '<span>‚Ü©</span> Topics';
                const point = grammarData.find(i => i.slug === window.currentSlug);
                title.innerText = point ? point.topic : 'Lesson';
                toggle.classList.remove('hidden'); document.getElementById('sidebar').classList.remove('hidden');
            }
        }

        // --- RENDERERS ---
        function renderLevels() {
            currentView = 'levels'; hideAll();
            document.getElementById('menu-view').classList.remove('hidden');
            document.getElementById('level-selection').classList.remove('hidden');
            
            const list = document.getElementById('level-list'); list.innerHTML = "";
            [...new Set(grammarData.map(i => i.level))].forEach(lvl => {
                const btn = document.createElement('button'); btn.className = 'fun-btn'; btn.innerText = lvl;
                btn.onclick = () => { currentLevel = lvl; renderTopics(lvl); };
                list.appendChild(btn);
            });
            updateHeader();
        }

        function renderTopics(lvl) {
            currentView = 'topics'; hideAll();
            document.getElementById('menu-view').classList.remove('hidden');
            document.getElementById('topic-selection').classList.remove('hidden');
            document.getElementById('selected-level-name').innerText = lvl;

            const list = document.getElementById('topic-list'); list.innerHTML = "";
            grammarData.filter(i => i.level === lvl).forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'fun-btn'; btn.style.backgroundColor = 'var(--btn-orange)';
                btn.style.borderColor = 'var(--btn-orange-dark)'; btn.style.borderBottomColor = 'var(--btn-orange-dark)';
                btn.innerText = item.topic;
                btn.onclick = () => loadLesson(item.slug);
                list.appendChild(btn);
            });
            updateHeader();
        }

        function loadLesson(slug) {
            currentView = 'content'; window.currentSlug = slug; hideAll();
            document.getElementById('content-view').classList.remove('hidden'); updateHeader();
            
            const point = grammarData.find(i => i.slug === slug);
            const btnBox = document.getElementById('resource-buttons');
            const stage = document.getElementById('lesson-content');
            
            btnBox.innerHTML = ""; stage.innerHTML = "";
            document.getElementById('intro-message').classList.remove('hidden');

            Object.keys(point.resources).forEach(key => {
                const btn = document.createElement('button');
                btn.className = 'resource-btn';
                
                // 1. FORMAT BUTTON LABEL
                const label = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                btn.innerText = label;
                
                btn.onclick = () => {
                    document.querySelectorAll('.resource-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById('intro-message').classList.add('hidden');
                    
                    const res = point.resources[key];
                    
                    // --- UNIVERSAL CONTENT HANDLER ---
                    // CHECK 1: Gapfill (Array of 'q' and 'a')
                    if (Array.isArray(res) && res.length > 0 && res[0].q) {
                         stage.innerHTML = `<div class="gap-container">` + 
                            res.map((item, idx) => {
                                const parts = item.q.split('___');
                                return `
                                <div class="gap-item">
                                    <span>${idx+1}. ${parts[0]}</span>
                                    <span class="gap-box" data-answer="${item.a}" onclick="toggleGap(this)"></span>
                                    <span>${parts[1] || ''}</span>
                                </div>`;
                            }).join('') + `</div>`;
                    }
                    // CHECK 2: Sentence List (Array of strings)
                    else if (Array.isArray(res) && typeof res[0] === 'string') {
                        stage.innerHTML = `<ul class="sentence-list">${res.map(s => `<li>${s}</li>`).join('')}</ul>`;
                    }
                    // CHECK 3: Image (String ending in image extension OR key is 'visual')
                    else if (typeof res === 'string' && (key.includes('visual') || res.match(/\.(jpeg|jpg|png|gif)$/))) {
                        stage.innerHTML = `<div style="text-align:center"><img src="${res}" style="max-height:70vh; max-width:100%; border-radius:15px; box-shadow:0 10px 20px rgba(0,0,0,0.1);"></div>`;
                    }
                    // CHECK 4: HTML/Video (Everything else)
                    else {
                        stage.innerHTML = res;
                    }
                };
                btnBox.appendChild(btn);
            });
        }

        function toggleGap(element) {
            const answer = element.dataset.answer;
            if (element.classList.contains('revealed')) {
                element.classList.remove('revealed'); element.innerText = ''; 
            } else {
                element.classList.add('revealed'); element.innerText = answer;
            }
        }

        function hideAll() {
            document.getElementById('menu-view').classList.add('hidden');
            document.getElementById('level-selection').classList.add('hidden');
            document.getElementById('topic-selection').classList.add('hidden');
            document.getElementById('content-view').classList.add('hidden');
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coursebook Pro: Grid Layout</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

    <style>
        :root { --primary: #4F46E5; --bg: #F3F4F6; --sidebar-width: 260px; --text-main: #1F2937; }
        body { background-color: var(--bg); color: var(--text-main); margin: 0; padding: 0; font-family: 'Poppins', sans-serif; display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        #sidebar { width: var(--sidebar-width); background: #111827; color: #9CA3AF; display: flex; flex-direction: column; flex-shrink: 0; z-index: 2000; transition: margin-left 0.3s ease; border-right: 1px solid #1f2937; }
        #sidebar.collapsed { margin-left: calc(var(--sidebar-width) * -1); }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid #374151; font-weight: 800; letter-spacing: 1px; color: white; font-size: 1.1rem; display:flex; gap:10px; align-items:center; }
        .tools-panel { padding: 1rem; background: #1f2937; border-bottom: 1px solid #374151; }
        .sidebar-btn { display: flex; align-items: center; gap: 10px; width: 100%; padding: 10px; margin-bottom: 5px; background: rgba(255,255,255,0.05); border: 1px solid transparent; color: white; border-radius: 8px; cursor: pointer; transition: all 0.2s; font-size: 0.9rem; font-weight: 500; }
        .sidebar-btn:hover { background: rgba(255,255,255,0.1); }
        .sidebar-btn.active { background: var(--primary); border-color: var(--primary); }
        .pdf-btn { background: #DC2626 !important; border-color: #DC2626 !important; font-weight: 700; margin-top: 10px; }
        
        .nav-list { flex-grow: 1; overflow-y: auto; padding: 1.5rem; }
        .nav-section-title { font-size: 0.75rem; text-transform: uppercase; color: #6B7280; font-weight: 800; letter-spacing: 1px; margin-bottom: 0.5rem; margin-top: 1.5rem; cursor: pointer; }
        .nav-section-title:hover { color: white; }
        .nav-item { padding: 6px 10px; cursor: pointer; color: #D1D5DB; border-radius: 4px; font-size: 0.9rem; margin-bottom: 2px; border-left: 3px solid transparent; transition: all 0.2s; }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: white; border-left-color: var(--primary); }

        /* MAIN STAGE */
        #main-stage { flex-grow: 1; position: relative; overflow-y: auto; background: var(--bg); display: flex; flex-direction: column; align-items: center; }
        .stage-header { position: sticky; top: 0; width: 100%; height: 60px; z-index: 1500; padding: 10px 20px; pointer-events: none; display: flex; align-items: center; }
        #toggle-btn { pointer-events: auto; background: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* PAPER PAGE */
        #paper-page { 
            width: 100%; max-width: 1300px; 
            background: white; min-height: 100vh; 
            padding: 5rem 6rem; 
            margin-top: -50px; margin-bottom: 100px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.05); 
            border-radius: 20px; 
            position: relative; 
        }

        /* GRID SYSTEM */
        #unit-container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Two Columns */
            gap: 3rem; /* Space between items */
            align-items: start;
        }

        /* --- THE BAR UPDATE --- */
        .col-span-2 { grid-column: span 2; }
        
        .block { position: relative; z-index: 10; scroll-margin-top: 100px; margin-bottom: 1rem; }
        
        h1 { font-family: 'Poppins', sans-serif; font-weight: 800; font-size: 3.5rem; line-height: 1.1; color: #111; margin: 0; letter-spacing: -1px; }
        h2 { font-family: 'Poppins', sans-serif; font-weight: 700; font-size: 1.8rem; color: var(--text-main); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 10px; border-bottom: 0; }
        h2::before { content: ''; display: block; width: 6px; height: 24px; background: var(--primary); border-radius: 3px; }

        .header-card { background: linear-gradient(135deg, #EFF6FF, #DBEAFE); padding: 4rem; border-radius: 24px; text-align: center; border: 1px solid #BFDBFE; margin-bottom: 2rem; }
        .level-tag { background: var(--primary); color: white; padding: 6px 16px; border-radius: 20px; font-weight: 700; font-size: 0.85rem; letter-spacing: 1px; text-transform: uppercase; display: inline-block; margin-bottom: 1rem; }
        
        /* WRAPPED TEXT */
        .wrapped-text-container { overflow: hidden; background: white; }
        .wrapped-image { float: right; width: 45%; margin: 0 0 20px 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); object-fit: cover; height: 300px; }
        .wrapped-content h3 { font-size: 2.2rem; margin-top: 0; color: #111; line-height: 1.2; margin-bottom: 1rem; }
        .wrapped-content p { font-size: 1.15rem; line-height: 1.9; color: #4B5563; font-family: 'Merriweather', serif; }
        @media(max-width: 900px) { .wrapped-image { float: none; width: 100%; margin: 0 0 20px 0; height: auto; } }

        /* EXAM TIP BAR (UPDATED) */
        .exam-tip { 
            grid-column: span 2; /* Force Full Width */
            background: #FEF3C7; 
            color: #92400E; 
            padding: 1rem 2rem; /* Slimmer padding */
            border-left: 6px solid #F59E0B; 
            border-radius: 8px; /* Simpler radius */
            font-family: 'Poppins', sans-serif; 
            font-size: 1rem; 
            font-weight: 500;
            display: flex; 
            align-items: center; 
            gap: 15px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin: 1rem 0; /* Clear separation */
        }
        
        .quiz-container { background: #F9FAFB; padding: 2rem; border-radius: 12px; border: 1px solid #E5E7EB; height: 100%; }
        .mc-question { margin-bottom: 1.5rem; }
        .mc-option { padding: 10px; border: 2px solid #E5E7EB; border-radius: 8px; margin-bottom: 5px; cursor: pointer; transition: all 0.2s; background: white; font-size: 0.9rem; }
        .mc-option:hover { border-color: #9CA3AF; }
        .mc-option.correct { background: #DCFCE7; border-color: #16A34A; color: #166534; }
        .mc-option.wrong { background: #FEE2E2; border-color: #EF4444; opacity: 0.6; }

        .reading-text { font-family: 'Merriweather', serif; font-size: 1.15rem; line-height: 2; color: #374151; text-align: justify; }
        .reading-columns { column-count: 2; column-gap: 4rem; }
        
        .speaking-box { background: #F0FDFA; border: 1px solid #CCFBF1; padding: 2rem; border-radius: 20px; display: flex; gap: 20px; align-items: flex-start; }
        .chat-bubble { background: white; padding: 1.5rem; border-radius: 0 20px 20px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid #E5E7EB; flex-grow: 1; }
        
        .audio-card { background: #1F2937; color: white; padding: 1.5rem; border-radius: 16px; display: flex; align-items: center; gap: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); flex-wrap: wrap; }
        .script-box { width: 100%; background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px; margin-top: 10px; display: none; font-family: monospace; line-height: 1.5; white-space: pre-wrap; color: #E5E7EB; }
        .script-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; margin-left: auto; }

        .match-container { display: flex; gap: 2rem; margin-top: 1rem; }
        .match-col { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .match-item { padding: 12px 15px; background: white; border: 2px solid #E5E7EB; border-radius: 10px; cursor: pointer; font-weight: 600; color: #374151; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: all 0.2s; font-size: 0.95rem; }
        .match-item:hover { transform: translateY(-2px); border-color: var(--primary); }
        .match-item.selected { background: #EEF2FF; border-color: var(--primary); color: var(--primary); transform: scale(1.02); z-index: 10; }
        .match-item.matched { background: #DCFCE7; border-color: #16A34A; color: #166534; opacity: 0.5; pointer-events: none; text-decoration: line-through; }
        
        .arcade-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 1rem; }
        .arcade-btn { background: white; border: 1px solid #E5E7EB; padding: 1.5rem; text-align: center; border-radius: 12px; cursor: pointer; font-weight: 700; color: var(--text-main); transition: all 0.2s; display: flex; flex-direction: column; gap: 5px; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .arcade-btn span { font-size: 1.5rem; }
        .arcade-btn:hover { border-color: var(--primary); transform: translateY(-2px); color: var(--primary); }

        .magic-gap { display: inline-block; min-width: 80px; padding: 2px 10px; margin: 0 5px; border-bottom: 2px solid #CBD5E1; background: #F8FAFC; color: transparent; cursor: pointer; text-align: center; font-weight: 600; border-radius: 4px; transition: all 0.3s; }
        .magic-gap.revealed { background: #DCFCE7; border-color: #16A34A; color: #166534; }

        #drawing-layer { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 9999; touch-action: none; }
        .cursor-pen { cursor: crosshair !important; }
        
        @media print { #sidebar, .stage-header { display: none !important; } body { background: white; height: auto; overflow: visible; } #paper-page { max-width: 100%; width: 100%; margin: 0; padding: 0; box-shadow: none; border-radius: 0; } #unit-container { display: block; } .col-span-2 { width: 100%; } }
        @media (max-width: 1000px) { #unit-container { display: block; } .col-span-2 { width: 100%; } }
    </style>
</head>
<body>
    
    <aside id="sidebar">
        <div class="sidebar-header"><span>üìö</span> COURSEBOOK PRO</div>
        <div class="tools-panel">
            <button class="sidebar-btn" id="btn-pen" onclick="togglePen()"><span>‚úèÔ∏è</span> <span>Board Pen</span></button>
            <div id="pen-options" style="display:none; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; margin-bottom: 10px;">
                <div style="display:flex; justify-content: space-between; margin-bottom:10px;">
                    <div style="width:30px; height:30px; background:#2563EB; border-radius:50%; cursor:pointer; border:2px solid white;" onclick="setPenColor('#2563EB')"></div>
                    <div style="width:30px; height:30px; background:#DC2626; border-radius:50%; cursor:pointer; border:2px solid white;" onclick="setPenColor('#DC2626')"></div>
                    <div style="width:30px; height:30px; background:#000000; border-radius:50%; cursor:pointer; border:2px solid white;" onclick="setPenColor('#000000')"></div>
                </div>
                <button class="sidebar-btn" onclick="setEraser()" style="font-size:0.8rem; background:#4B5563;">‚ö™ Eraser</button>
                <button class="sidebar-btn" onclick="clearDrawings()" style="font-size:0.8rem; background:#EF4444;">üóë Clear Board</button>
            </div>
            <button class="sidebar-btn" id="btn-reveal" onclick="toggleRevealAll()"><span>üëÅÔ∏è</span> <span>Reveal Answers</span></button>
            <button class="sidebar-btn pdf-btn" onclick="window.print()"><span>üìÑ</span> <span>Export PDF</span></button>
        </div>
        <div class="nav-list" id="nav-list"></div>
        <div style="padding:1.5rem; border-top:1px solid #374151;">
            <button class="sidebar-btn" onclick="window.location.href='builder-v2.html'" style="background:transparent; border:1px dashed #4B5563; color:#9CA3AF;">‚Üê Back to Builder</button>
        </div>
    </aside>

    <div id="main-stage">
        <div class="stage-header"><button id="toggle-btn" onclick="document.getElementById('sidebar').classList.toggle('collapsed')">‚ò∞</button></div>
        <div id="paper-page">
            <canvas id="drawing-layer"></canvas>
            <div id="unit-container"></div>
        </div>
    </div>

    <script>
        let isPenActive = false;
        let signaturePad;
        let revealState = false;
        let selectedMatchItem = null;

        window.addEventListener('load', () => {
            initCanvas(); 
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('source') === 'demo') {
                const localData = localStorage.getItem('demo_unit_data_v4');
                if (localData) {
                    const parsedData = JSON.parse(localData);
                    parsedData.forEach(block => {
                        if(block.type === 'image' || block.type === 'text_with_image') {
                            if(!block.url) block.url = `https://picsum.photos/seed/${Math.random()}/1000/600`;
                        }
                    });
                    renderBlocks(parsedData);
                } else loadFallbackDemo();
            } else loadFallbackDemo();
            new ResizeObserver(() => resizeCanvas()).observe(document.getElementById('paper-page'));
        });

        function renderBlocks(blocks) {
            const container = document.getElementById('unit-container');
            const nav = document.getElementById('nav-list');
            container.innerHTML = '';
            nav.innerHTML = '';
            let currentSection = '';
            let currentNavContainer = null;

            blocks.forEach((block, index) => {
                const blockId = `block-${index}`;

                if (block.section && block.section !== currentSection) {
                    currentSection = block.section;
                    const sectionTitle = document.createElement('div');
                    sectionTitle.className = 'nav-section-title';
                    sectionTitle.innerText = currentSection;
                    sectionTitle.onclick = () => document.getElementById(blockId).scrollIntoView({behavior:'smooth'});
                    nav.appendChild(sectionTitle);
                    currentNavContainer = document.createElement('div');
                    nav.appendChild(currentNavContainer);
                }
                
                if(currentNavContainer && ['text', 'ue_part2', 'audio', 'speaking', 'arcade', 'matching', 'multiple_choice', 'exam_tip'].includes(block.type)) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.innerText = block.title || block.headline || getLabel(block.type);
                    item.onclick = () => document.getElementById(blockId).scrollIntoView({behavior:'smooth'});
                    currentNavContainer.appendChild(item);
                }

                const div = document.createElement('div');
                div.className = 'block'; div.id = blockId;
                
                // EXAM TIP NOW FORCED TO FULL WIDTH (COL-SPAN-2)
                if(['header', 'text', 'text_with_image', 'image', 'magazine_split', 'speaking', 'audio', 'exam_tip'].includes(block.type)) {
                    div.classList.add('col-span-2');
                }

                switch(block.type) {
                    case 'header':
                        div.className += ' header-card';
                        div.innerHTML = `<div class="level-tag">${block.level || 'UNIT'}</div><h1>${block.title}</h1><p style="font-size:1.2rem; color:#4B5563; margin-top:1rem;">${block.subtitle || ''}</p>`;
                        break;

                    case 'text_with_image':
                        div.innerHTML = `<div class="wrapped-text-container"><img src="${block.url}" class="wrapped-image"><div class="wrapped-content"><h3>${block.headline}</h3><div style="width:50px; height:4px; background:var(--primary); margin-bottom:1rem;"></div><p>${block.text}</p></div></div>`;
                        break;

                    case 'text':
                        div.className += ' reading-card';
                        div.innerHTML = `<h2>üìñ ${block.headline || 'Reading'}</h2><div class="reading-text ${block.columns ? 'reading-columns' : ''}">${block.content}</div>`;
                        break;

                    case 'image':
                        div.innerHTML = `<figure style="margin:0;"><img src="${block.url}" style="width:100%; border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,0.1); display:block; object-fit: cover;"></figure>`;
                        break;

                    case 'audio':
                         div.className += ' audio-card';
                         const scriptId = `script-${index}`;
                         div.innerHTML = `<div style="font-size:2rem;">üéß</div><div style="flex-grow:1;"><h3 style="color:white; margin:0 0 5px 0;">Listening Task</h3><p style="margin:0; font-size:0.9rem; opacity:0.8;">${block.instructions || 'Listen to the track.'}</p></div><button class="script-btn" onclick="document.getElementById('${scriptId}').style.display = document.getElementById('${scriptId}').style.display === 'block' ? 'none' : 'block'">üìú Show Script</button><audio controls style="height:40px;"><source src="${block.url}" type="audio/mpeg"></audio><div id="${scriptId}" class="script-box">${block.script || 'No transcript available.'}</div>`;
                        break;

                    case 'multiple_choice':
                         div.innerHTML = `<h2>‚ùì ${block.title || 'Quiz'}</h2>`;
                         const qContainer = document.createElement('div');
                         qContainer.className = 'quiz-container';
                         block.questions.forEach((qObj, i) => {
                             const qDiv = document.createElement('div');
                             qDiv.className = 'mc-question';
                             qDiv.innerHTML = `<div class="mc-q-title">${i+1}. ${qObj.q}</div>`;
                             qObj.options.forEach(opt => {
                                 const btn = document.createElement('div'); btn.className = 'mc-option'; btn.innerText = opt;
                                 btn.onclick = function() { Array.from(qDiv.children).forEach(child => { if(child.classList.contains('mc-option')) child.classList.remove('wrong', 'correct'); }); if(opt === qObj.a) this.classList.add('correct'); else this.classList.add('wrong'); };
                                 qDiv.appendChild(btn);
                             });
                             qContainer.appendChild(qDiv);
                         });
                         div.appendChild(qContainer);
                         break;
                    
                    case 'arcade':
                         div.innerHTML = `<h2>üïπÔ∏è Arcade</h2><div class="arcade-grid">${(block.games || ['Hangman', 'Wordsearch']).map(game => `<div class="arcade-btn" onclick="alert('Launching ${game}...')"><span>${getGameIcon(game)}</span>${game}</div>`).join('')}</div>`;
                        break;

                    case 'exam_tip':
                        div.className += ' exam-tip';
                        div.innerHTML = `<span class="tip-icon">üìå</span><div><strong>EXAM TIP:</strong> ${block.content}</div>`; 
                        break;

                    case 'speaking':
                        div.className += ' speaking-card';
                        div.innerHTML = `<div style="font-size:3rem;">üí¨</div><div class="chat-bubble"><h3 style="margin-top:0; color:var(--primary);">Speaking: ${block.title}</h3><p>${block.content}</p><ul style="padding-left:20px; color:#4B5563;">${block.points.map(p => `<li style="margin-bottom:5px;">${p}</li>`).join('')}</ul></div>`;
                        break;

                    case 'ue_part2':
                        div.innerHTML = `<h2>üìù Open Cloze</h2><p style="color:#6B7280; margin-bottom:1rem;">One word per gap.</p>`;
                        const txt = document.createElement('div'); txt.className = 'reading-text';
                        txt.innerHTML = block.text.replace(/{{(.*?)}}/g, `<span class="magic-gap" onclick="this.classList.toggle('revealed')">$1</span>`);
                        div.appendChild(txt);
                        break;

                    case 'matching':
                        div.innerHTML = `<h2>üß© Matching</h2>`;
                        const container = document.createElement('div'); container.className = 'match-container';
                        const leftData = block.pairs.map((p,i) => ({t:p.left, id:i}));
                        const rightData = block.pairs.map((p,i) => ({t:p.right, id:i})).sort(() => Math.random()-0.5);
                        const leftCol = document.createElement('div'); leftCol.className = 'match-col';
                        const rightCol = document.createElement('div'); rightCol.className = 'match-col';
                        leftData.forEach(d => { const l=document.createElement('div'); l.className='match-item'; l.innerText=d.t; l.dataset.id=d.id; l.dataset.side='left'; l.onclick=(e)=>handleMatchClick(e.target); leftCol.appendChild(l); });
                        rightData.forEach(d => { const r=document.createElement('div'); r.className='match-item'; r.innerText=d.t; r.dataset.id=d.id; r.dataset.side='right'; r.onclick=(e)=>handleMatchClick(e.target); rightCol.appendChild(r); });
                        container.appendChild(leftCol); container.appendChild(rightCol); div.appendChild(container);
                        break;
                }
                container.appendChild(div);
            });
            setTimeout(resizeCanvas, 500);
        }

        function getLabel(type) { const map = {'text':'Reading', 'ue_part2':'Open Cloze', 'audio':'Audio', 'speaking':'Discussion', 'arcade':'Games', 'multiple_choice':'Quiz', 'exam_tip':'Tip'}; return map[type] || 'Activity'; }
        function getGameIcon(name) { const icons = {'Hangman':'üòµ', 'Wordsearch':'üîç', 'Crossword':'‚ñ¶', 'Anagram':'üî†'}; return icons[name] || 'üéÆ'; }

        function handleMatchClick(el) {
            if(el.classList.contains('matched')) return;
            if(!selectedMatchItem) { selectedMatchItem = el; el.classList.add('selected'); }
            else {
                if(selectedMatchItem === el) { el.classList.remove('selected'); selectedMatchItem = null; }
                else if(selectedMatchItem.dataset.side === el.dataset.side) { selectedMatchItem.classList.remove('selected'); selectedMatchItem = el; el.classList.add('selected'); }
                else {
                    if(selectedMatchItem.dataset.id === el.dataset.id) { el.classList.add('matched'); selectedMatchItem.classList.add('matched'); selectedMatchItem.classList.remove('selected'); selectedMatchItem = null; }
                    else { alert("Try again!"); selectedMatchItem.classList.remove('selected'); selectedMatchItem = null; }
                }
            }
        }

        function toggleRevealAll() {
            revealState = !revealState;
            const btn = document.getElementById('btn-reveal');
            const gaps = document.querySelectorAll('.magic-gap');
            if(revealState) { gaps.forEach(g => g.classList.add('revealed')); btn.innerHTML = "<span>üôà</span> <span>Hide All</span>"; }
            else { gaps.forEach(g => g.classList.remove('revealed')); btn.innerHTML = "<span>üëÅÔ∏è</span> <span>Reveal All</span>"; }
        }

        function togglePen() {
            isPenActive = !isPenActive;
            const btn = document.getElementById('btn-pen');
            const opts = document.getElementById('pen-options');
            const canvas = document.getElementById('drawing-layer');
            const paper = document.getElementById('paper-page');
            if(isPenActive) {
                btn.classList.add('active'); opts.style.display = 'block'; btn.innerHTML = "<span>‚ùå</span> <span>Stop Ink</span>";
                resizeCanvas();
                canvas.style.pointerEvents = 'auto'; canvas.style.border = "2px dashed rgba(79, 70, 229, 0.3)";
                paper.classList.add('cursor-pen');
                if(signaturePad) signaturePad.on();
            } else {
                btn.classList.remove('active'); opts.style.display = 'none'; btn.innerHTML = "<span>‚úèÔ∏è</span> <span>Board Pen</span>";
                canvas.style.border = "none"; canvas.style.pointerEvents = 'none'; paper.classList.remove('cursor-pen');
                if(signaturePad) signaturePad.off();
            }
        }
        function resizeCanvas() { const c = document.getElementById('drawing-layer'); const p = document.getElementById('paper-page'); if(c&&p) { c.width = p.scrollWidth; c.height = p.scrollHeight; } }
        function setPenColor(c) { if(signaturePad) { signaturePad.compositeOperation = 'source-over'; signaturePad.penColor = c; signaturePad.maxWidth = 3; } }
        function setEraser() { if(signaturePad) { signaturePad.compositeOperation = 'destination-out'; signaturePad.maxWidth = 20; } }
        function clearDrawings() { if(signaturePad) signaturePad.clear(); }
        function initCanvas() { const c = document.getElementById('drawing-layer'); if(typeof SignaturePad !== 'undefined') { signaturePad = new SignaturePad(c, { penColor: '#2563EB', minWidth: 2, maxWidth: 3 }); signaturePad.off(); } }
        function loadFallbackDemo() { renderBlocks([{ section: 'Welcome', type: 'header', title: 'Demo Mode', level: 'TEST', subtitle: 'Please generate a unit in the Builder.' }]); }
    </script>
</body>
</html>
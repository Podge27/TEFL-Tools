<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fun Classroom Timer</title>

<link rel="stylesheet" href="global.css">

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">

<style>
  :root {
    /* Fun Palette */
    --bg-color: #f0f4f8;
    --card-bg: #ffffff;
    --primary: #8b5cf6; /* Violet */
    --secondary: #64748b;
    --accent-blue: #3b82f6;
    --accent-green: #10b981;
    --accent-orange: #f97316;
    --accent-red: #ef4444;
    --text-main: #334155;
  }

  body {
    font-family: 'Nunito', sans-serif; /* Rounded font */
    background-color: var(--bg-color);
    background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
    background-size: 20px 20px;
    color: var(--text-main);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    margin: 0;
  }

  header {
    width: 100%;
    padding: 20px;
    display: flex;
    align-items: center;
  }

  /* Main Card */
  .container {
    background: var(--card-bg);
    padding: 2rem;
    border-radius: 30px; /* Super rounded corners */
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    width: 90%;
    max-width: 600px;
    text-align: center;
    margin-top: 10px;
    border: 4px solid #fff;
  }

  h1 {
    font-size: 2.2rem;
    margin: 0 0 1.5rem 0;
    color: var(--text-main);
    font-weight: 900;
    letter-spacing: -0.025em;
  }

  /* Mode Switcher (Pill Shape) */
  .mode-select {
    background: #e2e8f0;
    padding: 5px;
    border-radius: 50px;
    display: inline-flex;
    margin-bottom: 2rem;
    position: relative;
  }
  
  .mode-select button {
    padding: 10px 30px;
    border-radius: 40px;
    border: none;
    background: transparent;
    color: var(--secondary);
    font-size: 1rem;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Nunito', sans-serif;
  }
  
  .mode-select button.active {
    background: white;
    color: var(--primary);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  /* Fun Time Grid */
  .time-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(85px, 1fr));
    gap: 12px;
    margin-bottom: 1rem;
  }

  .time-btn {
    padding: 15px 5px;
    border-radius: 16px;
    background: white;
    color: var(--text-main);
    font-size: 1.1rem;
    font-weight: 800;
    border: 2px solid #e2e8f0;
    border-bottom-width: 5px; /* 3D effect */
    cursor: pointer;
    transition: all 0.1s;
    font-family: 'Nunito', sans-serif;
  }

  .time-btn:active {
    transform: translateY(3px);
    border-bottom-width: 2px;
  }

  /* Colorful accents for buttons */
  .time-btn:nth-child(4n+1):hover { border-color: var(--accent-blue); color: var(--accent-blue); background: #eff6ff; }
  .time-btn:nth-child(4n+2):hover { border-color: var(--accent-green); color: var(--accent-green); background: #f0fdf4; }
  .time-btn:nth-child(4n+3):hover { border-color: var(--accent-orange); color: var(--accent-orange); background: #fff7ed; }
  .time-btn:nth-child(4n+4):hover { border-color: var(--primary); color: var(--primary); background: #f5f3ff; }

  /* Custom Input */
  .custom-wrapper {
    grid-column: span 2;
    display: flex;
    gap: 5px;
    padding: 5px 10px;
    align-items: center;
  }
  
  .custom-input {
    width: 100%;
    border: none;
    background: transparent;
    font-size: 1.2rem;
    color: var(--text-main);
    font-weight: 800;
    text-align: center;
    outline: none;
    font-family: 'Nunito', sans-serif;
  }
  .custom-input::placeholder { color: #cbd5e1; }

  .custom-go-btn {
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 10px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.1s;
  }
  .custom-go-btn:hover { transform: scale(1.1); }

  /* Display Area */
  .display-container { margin: 1rem 0 2rem 0; }
  
  #display {
    font-size: clamp(4rem, 15vw, 7rem);
    font-weight: 900;
    font-variant-numeric: tabular-nums;
    letter-spacing: -3px;
    line-height: 1;
    color: var(--text-main);
    /* Soft colorful shadow */
    text-shadow: 3px 3px 0px #e2e8f0; 
  }

  /* Progress Bar */
  .progress-track {
    height: 14px;
    background: #f1f5f9;
    border-radius: 20px;
    margin-top: 20px;
    overflow: hidden;
    display: none;
    border: 2px solid #e2e8f0;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6, #8b5cf6);
    width: 100%;
    transition: width 1s linear;
    border-radius: 20px;
  }

  /* Control Buttons */
  .controls { display: flex; justify-content: center; gap: 12px; margin-top: 2rem; }
  
  .btn-control {
    padding: 12px 24px;
    border-radius: 16px;
    font-size: 1.1rem;
    font-weight: 800;
    color: white;
    border: none;
    border-bottom: 4px solid rgba(0,0,0,0.1); /* 3D effect */
    cursor: pointer;
    transition: all 0.1s;
    font-family: 'Nunito', sans-serif;
  }
  
  .btn-control:active {
    transform: translateY(3px);
    border-bottom-width: 1px;
  }
  
  .btn-start { background-color: var(--accent-green); }
  .btn-start.pause { background-color: var(--accent-orange); } /* State for Pause */
  
  .btn-clear { background-color: var(--accent-red); }
  
  .btn-back-ctrl { background-color: var(--secondary); }

  .adjust-controls { display: flex; justify-content: center; gap: 12px; margin-top: 10px; }
  .btn-adjust {
    background: white; color: var(--secondary); font-size: 0.9rem; font-weight: 700;
    padding: 8px 16px; border-radius: 12px; border: 2px solid #e2e8f0; cursor: pointer;
    font-family: 'Nunito', sans-serif;
  }
  .btn-adjust:hover { border-color: var(--primary); color: var(--primary); }

</style>
</head>
<body>

<header>
  <a href="index.html" class="btn-back">
     ← Back
  </a>
</header>

<div class="container">
  <h1>⏱️ Class Timer</h1>

  <div class="mode-select">
    <button id="modeTimer" class="active" onclick="setMode('timer')">Timer</button>
    <button id="modeStopwatch" onclick="setMode('stopwatch')">Stopwatch</button>
  </div>

  <div id="selectionView">
    <div class="time-grid" id="timeGrid"></div>
  </div>

  <div id="activeView" style="display:none;">
    <div class="display-container">
      <div id="display">00:00</div>
      <div class="progress-track" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <div class="adjust-controls" id="adjustRow">
      <button class="btn-adjust" onclick="adjustTime(30)">+ 30s</button>
      <button class="btn-adjust" onclick="adjustTime(-30)">- 30s</button>
    </div>

    <div class="controls">
      <button class="btn-control btn-start" id="startBtn" onclick="toggleTimer()">Start</button>
      <button class="btn-control btn-clear" onclick="resetTimer()">Reset</button>
      <button class="btn-control btn-back-ctrl" onclick="goBack()">Back</button>
    </div>
  </div>
</div>

<script>
let totalSeconds = 0;
let initialSeconds = 0;
let interval = null;
let mode = "timer";
let isRunning = false;
const defaultTitle = "Class Timer"; 

const timeOptions = [10, 30, 45, 60, 90, 120, 180, 240, 300, 600, 900, 1200, 1800, 2700];

window.onload = () => generateTimeButtons();

function setMode(selected) {
  mode = selected;
  
  // Update Tab UI
  document.getElementById('modeTimer').className = mode === 'timer' ? 'active' : '';
  document.getElementById('modeStopwatch').className = mode === 'stopwatch' ? 'active' : '';
  
  if (mode === 'timer') {
      goBack();
  } else {
      prepareStopwatch();
  }
}

function generateTimeButtons() {
  const container = document.getElementById('timeGrid');
  container.innerHTML = '';
  
  timeOptions.forEach(sec => {
    const btn = document.createElement('button');
    btn.className = 'time-btn';
    btn.textContent = formatHumanReadable(sec);
    // Fix: Clicking a time button forces mode to 'timer'
    btn.onclick = () => selectTime(sec);
    container.appendChild(btn);
  });

  // Custom Input
  const customWrapper = document.createElement('div');
  customWrapper.className = 'time-btn custom-wrapper';
  
  const input = document.createElement('input');
  input.inputMode = 'numeric'; 
  input.type = 'text'; 
  input.placeholder = '00:00';
  input.className = 'custom-input';
  
  input.addEventListener('input', function(e) {
      let raw = e.target.value.replace(/[^0-9]/g, '');
      if (raw.length > 2) {
          const seconds = raw.slice(-2);
          const minutes = raw.slice(0, raw.length - 2);
          e.target.value = `${minutes}:${seconds}`;
      } else {
          e.target.value = raw;
      }
  });

  input.addEventListener('keypress', function (e) {
    if (e.key === 'Enter') handleSmartInput(input.value);
  });

  const goBtn = document.createElement('button');
  goBtn.className = 'custom-go-btn';
  // Simple checkmark icon
  goBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';
  goBtn.onclick = () => handleSmartInput(input.value);

  customWrapper.appendChild(input);
  customWrapper.appendChild(goBtn);
  container.appendChild(customWrapper);
}

function handleSmartInput(val) {
  if(!val) return;
  const raw = val.replace(/[^0-9:]/g, ''); 
  let totalSecs = 0;

  if (raw.includes(':')) {
    const parts = raw.split(':');
    if (parts.length === 3) {
        totalSecs = (+parts[0] * 3600) + (+parts[1] * 60) + (+parts[2]);
    } else {
        totalSecs = (+parts[0] * 60) + (+parts[1]);
    }
  } else {
    const num = parseInt(raw, 10);
    if (isNaN(num)) return;
    if (num < 100) totalSecs = num;
    else {
        const s = num % 100;
        const m = Math.floor(num / 100);
        totalSecs = (m * 60) + s;
    }
  }

  if (totalSecs > 0) selectTime(totalSecs);
}

function selectTime(sec) {
  // CRITICAL FIX: Ensure mode is set to timer when selecting a preset
  mode = 'timer';
  document.getElementById('modeTimer').className = 'active';
  document.getElementById('modeStopwatch').className = '';

  totalSeconds = sec;
  initialSeconds = sec;
  showActiveView();
  updateDisplay();
  updateProgress();
  document.getElementById('progressBar').style.display = 'block';
  document.getElementById('adjustRow').style.visibility = 'visible';
}

function prepareStopwatch() {
  totalSeconds = 0;
  initialSeconds = 0;
  showActiveView();
  updateDisplay();
  document.getElementById('progressBar').style.display = 'none';
  document.getElementById('adjustRow').style.visibility = 'hidden';
}

function showActiveView() {
  document.getElementById('selectionView').style.display = 'none';
  document.getElementById('activeView').style.display = 'block';
  document.querySelector('.mode-select').style.display = 'none';
}

function goBack() {
  pauseTimer();
  document.getElementById('selectionView').style.display = 'block';
  document.getElementById('activeView').style.display = 'none';
  document.querySelector('.mode-select').style.display = 'inline-flex';
  document.getElementById('progressBar').style.display = 'none';
  
  const startBtn = document.getElementById('startBtn');
  startBtn.textContent = "Start";
  startBtn.classList.remove('pause');
  
  document.getElementById('display').style.color = "var(--text-main)";
  
  const customInput = document.querySelector('.custom-input');
  if(customInput) customInput.value = '';
  
  document.title = defaultTitle;
}

function adjustTime(amount) {
  totalSeconds = Math.max(0, totalSeconds + amount);
  if(totalSeconds > initialSeconds) initialSeconds = totalSeconds; 
  updateDisplay();
  updateProgress();
}

function toggleTimer() {
  if (isRunning) pauseTimer();
  else startTimer();
}

function startTimer() {
  if (interval) return;
  isRunning = true;
  
  const btn = document.getElementById('startBtn');
  btn.textContent = "Pause";
  btn.classList.add('pause');

  interval = setInterval(() => {
    if (mode === 'timer') {
      totalSeconds--;
      if (totalSeconds <= 0) {
        totalSeconds = 0;
        timerFinished();
      }
    } else {
      totalSeconds++;
    }
    updateDisplay();
    updateProgress();
  }, 1000);
}

function pauseTimer() {
  clearInterval(interval);
  interval = null;
  isRunning = false;
  
  const btn = document.getElementById('startBtn');
  btn.textContent = "Start";
  btn.classList.remove('pause');
}

function resetTimer() {
  pauseTimer();
  totalSeconds = mode === 'timer' ? initialSeconds : 0;
  updateDisplay();
  updateProgress();
  document.getElementById('display').style.color = "var(--text-main)";
  document.title = defaultTitle;
}

function timerFinished() {
  pauseTimer();
  // Optional: Play a sound if you link Tone.js, but visual is enough for now
  const display = document.getElementById('display');
  display.style.transform = "scale(1.1)";
  display.style.color = "var(--danger)"; 
  document.title = "⏰ TIME'S UP!"; 
  setTimeout(() => {
    display.style.transform = "scale(1)";
  }, 500);
}

function updateDisplay() {
  const timeString = formatTime(totalSeconds);
  document.getElementById('display').textContent = timeString;
  
  if (isRunning) {
      document.title = `${timeString} - Timer`;
  }
}

function updateProgress() {
  if (mode === 'stopwatch' || initialSeconds === 0) return;
  const percentage = Math.max(0, (totalSeconds / initialSeconds) * 100);
  document.getElementById('progressFill').style.width = percentage + "%";
}

function formatTime(sec) {
  let h = Math.floor(sec / 3600);
  let m = Math.floor((sec % 3600) / 60);
  let s = sec % 60;

  if (h > 0) {
    return `${h}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
  } else {
    return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
  }
}

function formatHumanReadable(sec) {
  if (sec < 60) return sec + 's';
  let m = Math.floor(sec / 60);
  let s = sec % 60;
  if (s === 0) return m + 'm';
  return `${m}m ${s}s`;
}
</script>
</body>
</html>
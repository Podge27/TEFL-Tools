<!DOCTYPE html>
<html>
<head>
    <title>Stickman Pizza Run: The Chase</title>
    <style>
        body { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            background-color: #222; 
            margin: 0;
            font-family: sans-serif;
            color: white;
        }
        canvas { 
            background-color: #87CEEB; /* Sky Blue */
            border: 4px solid #fff; 
        }
        #ui {
            position: absolute;
            top: 20px;
            font-size: 20px;
        }
    </style>
</head>
<body>

<div id="ui">Controls: Arrows to Move, Space to Jump. Run to the Pizzeria!</div>
<canvas id="gameCanvas" width="800" height="400"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- GAME STATE ---
    let gameActive = true;
    let frameCount = 0; // Counts how long the game has run (used for animation)

    // --- THE ACTORS ---
    let stickman = {
        x: 100,
        y: 300,
        width: 30,  // Used for collision
        height: 100,
        velocityY: 0,
        speed: 5,
        isJumping: false,
        legFrame: 0 // 0 = legs open, 1 = legs closed
    };

    let monster = {
        x: -100, // Starts off-screen to the left
        speed: 2 // Slower than player, but never stops
    };

    // Obstacles (Walls/Cats) - Simple data objects
    let obstacles = [
        {x: 600, y: 340, w: 40, h: 40},
        {x: 1200, y: 340, w: 40, h: 40},
        {x: 1800, y: 320, w: 40, h: 60} // Taller obstacle
    ];

    let pizzeriaX = 2500; // The Finish Line

    // --- CONTROLS ---
    let keys = {
        right: false,
        left: false,
        up: false
    };

    document.addEventListener('keydown', (e) => {
        if (e.code === 'ArrowRight') keys.right = true;
        if (e.code === 'ArrowLeft') keys.left = true;
        if (e.code === 'Space') keys.up = true;
    });

    document.addEventListener('keyup', (e) => {
        if (e.code === 'ArrowRight') keys.right = false;
        if (e.code === 'ArrowLeft') keys.left = false;
        if (e.code === 'Space') keys.up = false;
    });

    // --- LOGIC: COLLISION DETECTION ---
    // This looks scary, but it just checks if two rectangles overlap
    function checkCollision(rect1, rect2) {
        return (
            rect1.x < rect2.x + rect2.w &&
            rect1.x + rect1.width > rect2.x &&
            rect1.y < rect2.y + rect2.h &&
            rect1.y + rect1.height > rect2.y
        );
    }

    // --- LOGIC: UPDATE ---
    function update() {
        if (!gameActive) return;

        // 1. Stickman Movement
        if (keys.right) {
            stickman.x += stickman.speed;
        }
        if (keys.left && stickman.x > 0) {
            stickman.x -= stickman.speed;
        }

        // 2. Jumping Physics
        if (keys.up && !stickman.isJumping) {
            stickman.velocityY = -15;
            stickman.isJumping = true;
        }
        stickman.velocityY += 0.8; // Gravity
        stickman.y += stickman.velocityY;

        // Floor collision
        if (stickman.y > 300) {
            stickman.y = 300;
            stickman.isJumping = false;
            stickman.velocityY = 0;
        }

        // 3. Animation Logic (Leg switching)
        frameCount++;
        if (frameCount % 10 === 0) { // Every 10 frames...
            // Flip the switch: if 0 make it 1, if 1 make it 0
            stickman.legFrame = (stickman.legFrame === 0) ? 1 : 0;
        }

        // 4. Monster Chase
        monster.x += monster.speed;

        // 5. Check Death (Monster catches you)
        // Note: We give the stickman a "hitbox" closer to his body center
        if (monster.x + 50 > stickman.x) {
            alert("CHOMP! The monster caught you.");
            gameActive = false;
            location.reload(); // Restarts game
        }

        // 6. Check Death (Obstacles)
        obstacles.forEach(obs => {
            if (checkCollision(stickman, obs)) {
                alert("Ouch! You hit an obstacle.");
                gameActive = false;
                location.reload();
            }
        });

        // 7. Check Win
        if (stickman.x > pizzeriaX) {
            alert("MAMA MIA! You reached the Pizzeria!");
            gameActive = false;
        }
    }

    // --- DRAWING ---
    function draw() {
        // Clear screen
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // CAMERA TRICK:
        // We shift the entire world to the left based on player position
        // This keeps the player visible even when he runs to x=2000
        let cameraOffset = stickman.x - 200; 
        if (cameraOffset < 0) cameraOffset = 0; // Don't show negative world
        
        ctx.save(); // Save current view settings
        ctx.translate(-cameraOffset, 0); // Shift the camera

        // 1. Draw Floor
        ctx.fillStyle = "#654321";
        ctx.fillRect(0, 380, 3000, 20); // Very long floor

        // 2. Draw Pizzeria (Goal)
        ctx.fillStyle = "orange";
        ctx.fillRect(pizzeriaX, 200, 200, 180);
        ctx.fillStyle = "white";
        ctx.font = "20px Arial";
        ctx.fillText("PIZZA", pizzeriaX + 50, 250);

        // 3. Draw Obstacles (Red Boxes)
        ctx.fillStyle = "red";
        obstacles.forEach(obs => {
            ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
        });

        // 4. Draw Monster (Dark Blob)
        ctx.fillStyle = "purple";
        ctx.beginPath();
        ctx.arc(monster.x, 340, 50, 0, Math.PI * 2);
        ctx.fill();
        // Monster Eyes
        ctx.fillStyle = "red";
        ctx.beginPath();
        ctx.arc(monster.x + 20, 330, 5, 0, Math.PI * 2);
        ctx.fill();


        // 5. Draw Stickman
        // We use the 'legFrame' variable to decide which legs to draw
        drawStickman(stickman.x, stickman.y, stickman.legFrame);

        ctx.restore(); // Undo camera shift so it doesn't break next frame
        requestAnimationFrame(loop);
    }

    function drawStickman(x, y, frame) {
        ctx.strokeStyle = "black";
        ctx.lineWidth = 3;

        // HEAD
        ctx.beginPath();
        ctx.arc(x, y, 20, 0, Math.PI * 2); 
        ctx.stroke();

        // FACE (New!)
        ctx.fillStyle = "black";
        ctx.beginPath();
        ctx.arc(x - 5, y - 5, 2, 0, Math.PI * 2); // Left Eye
        ctx.arc(x + 5, y - 5, 2, 0, Math.PI * 2); // Right Eye
        ctx.fill();
        ctx.beginPath();
        ctx.arc(x, y, 10, 0, Math.PI, false); // Mouth (half circle)
        ctx.stroke();

        // BODY
        ctx.beginPath();
        ctx.moveTo(x, y + 20);
        ctx.lineTo(x, y + 60);
        ctx.stroke();

        // ARMS (Animate based on 'frame')
        ctx.beginPath();
        if (frame === 0) { // Arms Up
            ctx.moveTo(x, y + 40); ctx.lineTo(x - 20, y + 20);
            ctx.moveTo(x, y + 40); ctx.lineTo(x + 20, y + 20);
        } else { // Arms Down
            ctx.moveTo(x, y + 40); ctx.lineTo(x - 20, y + 50);
            ctx.moveTo(x, y + 40); ctx.lineTo(x + 20, y + 50);
        }
        ctx.stroke();

        // LEGS (Animate)
        ctx.beginPath();
        if (frame === 0 && !stickman.isJumping) { // Open Legs (Walking)
            ctx.moveTo(x, y + 60); ctx.lineTo(x - 15, y + 90);
            ctx.moveTo(x, y + 60); ctx.lineTo(x + 15, y + 90);
        } else if (stickman.isJumping) { // Jumping Pose
             ctx.moveTo(x, y + 60); ctx.lineTo(x - 10, y + 80);
             ctx.moveTo(x, y + 60); ctx.lineTo(x + 20, y + 85);
        } else { // Closed Legs (Standing/mid-stride)
            ctx.moveTo(x, y + 60); ctx.lineTo(x, y + 90);
            ctx.moveTo(x, y + 60); ctx.lineTo(x, y + 90);
        }
        ctx.stroke();

        // HAIRS (Still there!)
        ctx.beginPath();
        ctx.moveTo(x - 10, y - 18); ctx.lineTo(x - 15, y - 28);
        ctx.moveTo(x, y - 20); ctx.lineTo(x, y - 30);
        ctx.moveTo(x + 10, y - 18); ctx.lineTo(x + 15, y - 28);
        ctx.stroke();
    }

    function loop() {
        update();
        draw();
    }

    loop();

</script>
</body>
</html>
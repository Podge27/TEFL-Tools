<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Quiz Library</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

    <style type="text/tailwindcss">
        /* Base Settings */
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; min-height: 100vh; }
        #app-container { @apply w-full max-w-6xl mx-auto bg-white shadow-2xl rounded-3xl overflow-hidden min-h-[700px] flex flex-col relative; }

        /* Navigation & Buttons */
        .btn-nav { @apply px-6 py-3 font-bold rounded-xl shadow-md transition transform hover:scale-105 active:scale-95 text-white text-center; }
        .level-btn { @apply flex flex-col items-center justify-center p-8 rounded-2xl border-4 border-transparent transition-all duration-300 cursor-pointer shadow-lg hover:-translate-y-2; }
        .level-btn:hover { @apply border-indigo-200; }
        
        /* Cards */
        .quiz-card { @apply bg-white p-5 rounded-xl border-l-8 shadow-sm hover:shadow-md transition-all cursor-pointer flex justify-between items-center border-gray-100; }
        .quiz-card:hover { @apply bg-gray-50 translate-x-1; }
        .border-grammar { border-left-color: #3b82f6; } 
        .border-vocab { border-left-color: #10b981; }   

        /* Player Options */
        .option-btn { @apply w-full text-left p-5 rounded-xl border-2 border-gray-100 font-semibold text-gray-700 transition-all hover:border-indigo-300 hover:bg-indigo-50 mb-3; }
        .option-btn.selected { @apply border-indigo-600 bg-indigo-50 ring-2 ring-indigo-200; }
        
        /* New: The Reveal Button Style */
        .reveal-box { @apply w-full py-10 border-4 border-dashed border-gray-300 rounded-xl text-gray-400 font-bold text-xl hover:bg-indigo-50 hover:border-indigo-300 hover:text-indigo-500 transition-all flex flex-col items-center justify-center gap-2 cursor-pointer; }

        .review-card { @apply p-6 rounded-xl border-2 border-red-100 bg-red-50/30 mb-4; }
    </style>
</head>
<body class="p-4 sm:p-8 flex flex-col items-center justify-center">

    <a href="index.html" class="absolute top-6 left-6 flex items-center gap-2 text-gray-600 hover:text-indigo-700 font-bold transition z-50 group">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform group-hover:-translate-x-1 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        <span>Back to Tools</span>
    </a>

    <div id="app-container">
        <div class="bg-white border-b border-gray-100 px-8 py-6 flex justify-between items-center">
            <h1 class="text-3xl font-black text-gray-900">Quiz <span class="text-indigo-600">Time</span></h1>
            <span id="current-level-badge" class="hidden bg-indigo-100 text-indigo-700 px-4 py-1 rounded-full font-bold text-sm">LEVEL</span>
        </div>

        <div id="view-levels" class="flex-1 flex flex-col justify-center items-center p-12">
            <h2 class="text-3xl font-bold text-gray-700 mb-10">Choose your level</h2>
            <div id="loading-msg" class="text-indigo-500 font-bold animate-pulse mb-4">Loading Quizzes...</div>
            <div id="level-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-4xl"></div>
        </div>

        <div id="view-menu" class="hidden flex-1 p-10 bg-gray-50 overflow-y-auto">
            <button onclick="app.showLevels()" class="mb-6 text-sm font-bold text-gray-400 hover:text-gray-600">‚Üê Change Level</button>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                <div>
                    <h3 class="text-xl font-black text-blue-500 mb-4 flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-blue-500"></span> GRAMMAR</h3>
                    <div id="list-grammar" class="space-y-3"></div>
                </div>
                <div>
                    <h3 class="text-xl font-black text-green-500 mb-4 flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-500"></span> VOCABULARY</h3>
                    <div id="list-vocab" class="space-y-3"></div>
                </div>
            </div>
        </div>

        <div id="view-player" class="hidden flex-1 flex flex-col p-10 bg-white">
            <div class="w-full bg-gray-100 h-2 rounded-full mb-8">
                <div id="progress-bar" class="bg-indigo-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>

            <div class="flex-1 max-w-3xl mx-auto w-full">
                <div class="flex justify-between items-center mb-6">
                    <span id="q-counter" class="text-gray-400 font-bold text-sm uppercase tracking-widest">Question 1</span>
                    <button onclick="app.exitQuiz()" class="text-gray-400 hover:text-red-500 font-bold text-sm transition flex items-center gap-1">EXIT <span class="text-lg">‚úï</span></button>
                </div>

                <h2 id="q-text" class="text-2xl md:text-3xl font-bold text-gray-800 mt-4 mb-8 leading-relaxed">...</h2>
                
                <div id="q-options" class="space-y-2"></div>
                
                <div id="feedback" class="hidden mt-6 p-6 rounded-xl bg-gray-50 border border-gray-200">
                    <h3 id="fb-title" class="font-bold text-lg mb-1"></h3>
                    <p id="fb-text" class="text-gray-600"></p>
                </div>
            </div>

            <div class="border-t border-gray-100 pt-6 mt-6 flex justify-end">
                <button id="next-btn" onclick="app.nextQuestion()" class="hidden btn-nav bg-indigo-600 hover:bg-indigo-700">Continue ‚Üí</button>
            </div>
        </div>

        <div id="view-results" class="hidden flex-1 flex flex-col items-center justify-center p-10">
            <h2 class="text-4xl font-black text-gray-800 mb-8">Quiz Complete!</h2>
            <div id="res-circle" class="w-40 h-40 rounded-full border-8 flex flex-col items-center justify-center mx-auto mb-6">
                <span id="res-percent" class="text-5xl font-black">0%</span>
            </div>
            <p id="res-text" class="text-xl text-gray-500 font-medium mb-10">You scored 0/0</p>
            <div class="flex flex-wrap gap-4 justify-center">
                <button onclick="app.showMenu()" class="btn-nav bg-gray-800 hover:bg-gray-900">Back to Menu</button>
                <button onclick="app.restartQuiz()" class="btn-nav bg-indigo-600 hover:bg-indigo-700">Retry Quiz</button>
                <button id="btn-review" onclick="app.showReview()" class="hidden btn-nav bg-orange-500 hover:bg-orange-600">Review Mistakes</button>
            </div>
        </div>

        <div id="view-review" class="hidden flex-1 p-10 bg-gray-50 overflow-y-auto">
            <div class="max-w-3xl mx-auto">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-black text-gray-800">Incorrect Answers</h2>
                    <button onclick="app.switchView('view-results')" class="text-gray-500 hover:text-gray-800 font-bold">Close Review</button>
                </div>
                <div id="review-list" class="space-y-6"></div>
                <div class="mt-8 text-center">
                    <button onclick="app.switchView('view-results')" class="btn-nav bg-gray-800">Back to Results</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let quizzes = []; 

        const app = {
            state: { currentQuiz: null, qIdx: 0, score: 0, selectedLevel: null, wrongAnswers: [] },

            init: async function() {
                try {
                    const response = await fetch('quizzes.json');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    quizzes = await response.json();
                    document.getElementById('loading-msg').style.display = 'none';
                    this.renderLevels();
                } catch (error) {
                    console.error("Could not load quizzes:", error);
                    document.getElementById('loading-msg').innerText = "Error loading data.";
                }
            },

            switchView: function(viewId) {
                ['view-levels', 'view-menu', 'view-player', 'view-results', 'view-review'].forEach(id => document.getElementById(id).classList.add('hidden'));
                document.getElementById(viewId).classList.remove('hidden');
            },

            renderLevels: function() {
                const levels = [...new Set(quizzes.map(q => q.level))].sort();
                const container = document.getElementById('level-grid');
                container.innerHTML = '';
                const gradients = { 'A1': 'from-blue-300 to-blue-500', 'A2': 'from-blue-400 to-blue-600', 'B1': 'from-indigo-400 to-indigo-600', 'B2': 'from-indigo-500 to-indigo-700', 'C1': 'from-orange-400 to-pink-500', 'C2': 'from-green-500 to-emerald-700' };
                levels.forEach(lvl => {
                    const btn = document.createElement('div');
                    const grad = gradients[lvl] || 'from-gray-500 to-gray-700';
                    btn.className = `level-btn bg-gradient-to-br ${grad} text-white`;
                    btn.innerHTML = `<span class="text-6xl font-black opacity-80">${lvl}</span><span class="font-bold mt-2 opacity-75">SELECT</span>`;
                    btn.onclick = () => this.selectLevel(lvl);
                    container.appendChild(btn);
                });
            },

            selectLevel: function(lvl) {
                this.state.selectedLevel = lvl;
                document.getElementById('current-level-badge').innerText = lvl;
                document.getElementById('current-level-badge').classList.remove('hidden');
                this.renderMenu(lvl);
                this.switchView('view-menu');
            },

            showLevels: function() {
                this.switchView('view-levels');
                document.getElementById('current-level-badge').classList.add('hidden');
            },

            renderMenu: function(lvl) {
                const gList = document.getElementById('list-grammar');
                const vList = document.getElementById('list-vocab');
                gList.innerHTML = ''; vList.innerHTML = '';
                const filtered = quizzes.filter(q => q.level === lvl).sort((a,b) => a.title.localeCompare(b.title));
                
                if(filtered.length === 0) { gList.innerHTML = "<p class='text-gray-400 italic'>No quizzes found.</p>"; return; }

                filtered.forEach(q => {
                    const card = document.createElement('div');
                    card.className = `quiz-card border-${q.category}`;
                    card.innerHTML = `<div><h4 class="font-bold text-gray-800 text-lg">${q.title}</h4><span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${q.questions.length} Questions</span></div><div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">‚ñ∂</div>`;
                    card.onclick = () => this.startQuiz(q);
                    if(q.category === 'grammar') gList.appendChild(card); else vList.appendChild(card);
                });
            },

            showMenu: function() { this.switchView('view-menu'); },

            startQuiz: function(quiz) {
                this.state.currentQuiz = quiz;
                this.state.qIdx = 0;
                this.state.score = 0;
                this.state.wrongAnswers = []; 
                this.switchView('view-player');
                this.renderQuestion();
            },

            exitQuiz: function() {
                if(confirm("Exit this quiz? Your progress will be lost.")) {
                    this.showMenu();
                }
            },

            // --- CHANGED: HIDE/SHOW LOGIC ---
            renderQuestion: function() {
                const q = this.state.currentQuiz.questions[this.state.qIdx];
                const total = this.state.currentQuiz.questions.length;
                document.getElementById('q-counter').innerText = `Question ${this.state.qIdx + 1} of ${total}`;
                document.getElementById('q-text').innerText = q.text;
                document.getElementById('feedback').classList.add('hidden');
                document.getElementById('next-btn').classList.add('hidden');
                document.getElementById('progress-bar').style.width = `${((this.state.qIdx)/total)*100}%`;

                const optContainer = document.getElementById('q-options');
                optContainer.innerHTML = ''; // Clear container

                // 1. Create the "Reveal" Button
                const revealBtn = document.createElement('div');
                revealBtn.className = 'reveal-box';
                revealBtn.innerHTML = `<span>üëÅÔ∏è Show Options</span><span class="text-sm font-normal opacity-70">(Try to answer without looking!)</span>`;
                
                // 2. Create the hidden wrapper for actual answers
                const choicesWrapper = document.createElement('div');
                choicesWrapper.className = 'hidden space-y-2'; 

                // 3. Create Option Buttons
                q.options.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerText = opt;
                    btn.onclick = () => this.checkAnswer(idx, btn);
                    choicesWrapper.appendChild(btn);
                });

                // 4. Add logic: Click Reveal -> Hide Reveal, Show Choices
                revealBtn.onclick = () => {
                    revealBtn.classList.add('hidden');
                    choicesWrapper.classList.remove('hidden');
                };

                // 5. Append both to the screen
                optContainer.appendChild(revealBtn);
                optContainer.appendChild(choicesWrapper);
            },

            checkAnswer: function(selectedIndex, btnElement) {
                const allBtns = document.querySelectorAll('.option-btn');
                allBtns.forEach(b => b.disabled = true);
                btnElement.classList.add('selected');

                const q = this.state.currentQuiz.questions[this.state.qIdx];
                const fbBox = document.getElementById('feedback');
                const fbTitle = document.getElementById('fb-title');
                const fbText = document.getElementById('fb-text');

                fbBox.classList.remove('hidden');
                document.getElementById('next-btn').classList.remove('hidden');

                if(selectedIndex === q.answer) {
                    this.state.score++;
                    fbBox.className = "mt-6 p-6 rounded-xl bg-green-50 border border-green-200";
                    fbTitle.innerHTML = "‚úÖ Correct!";
                    fbTitle.className = "font-bold text-lg mb-1 text-green-700";
                } else {
                    this.state.wrongAnswers.push({
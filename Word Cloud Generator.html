<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Word Cloud</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
        /* Global & Layout Styles (Matched to your Reference) */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #00BCD4, #4DD0E1); /* Cyan Blue Theme */
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        #app-container {
            width: 95vw;
            max-width: 1000px;
            min-height: 80vh;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding: 24px;
            display: flex;
            flex-direction: column;
        }

        /* Input Styles */
        textarea {
            @apply w-full p-4 border-2 border-cyan-100 rounded-xl focus:outline-none focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 transition duration-200 resize-y bg-cyan-50 text-gray-700 font-medium;
        }

        /* Button Styles */
        .btn-primary {
            @apply px-6 py-3 bg-blue-500 text-white rounded-xl shadow-lg hover:bg-blue-600 transition duration-150 font-bold text-lg;
        }
        
        .btn-action {
            @apply w-full px-4 py-3 bg-green-500 text-white rounded-xl shadow-lg hover:bg-green-600 transition duration-150 text-xl font-black mt-2;
        }

        .btn-secondary {
            @apply px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold transition;
        }

        /* Word Cloud Canvas Styles */
        #word-cloud-wrapper {
            @apply mt-6 bg-slate-50 border-4 border-cyan-100 rounded-xl p-2 relative;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }

        #word-cloud {
            min-height: 500px;
            position: relative; /* Essential for absolute positioning */
            overflow: hidden; 
            background-color: white; /* White bg for the saved image */
            border-radius: 8px;
        }

        /* Individual Word Styles */
        .cloud-word {
            position: absolute;
            white-space: nowrap;
            padding: 4px 8px;
            font-weight: 900; /* Extra Bold */
            line-height: 1;
            cursor: default;
            user-select: none;
            transition: transform 0.2s;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.05);
            font-size: 24px; /* Fixed Size */
        }

        .cloud-word:hover {
            transform: scale(1.1);
            z-index: 50;
        }
    </style>
</head>
<body>

    <div id="app-container">

        <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-gray-100 pb-4 gap-4">
            <button onclick="window.location.href = 'index.html'" class="btn-secondary self-start md:self-center">
                ‚Üê Back to Tools
            </button>
            <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 text-center">Word Cloud Generator</h1>
            <div class="w-24"></div> </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-2">
            
            <div class="md:col-span-2 flex flex-col">
                <label class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-2">Paste Words or Phrases</label>
                <textarea id="word-input" rows="5" placeholder="Enter words separated by commas or new lines..."></textarea>
            </div>
            
            <div class="md:col-span-1 flex flex-col justify-end space-y-3">
                
                <div>
                    <label class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-2 block">Or Load from File</label>
                    <button id="file-button" class="btn-primary w-full text-base py-2 bg-indigo-500 hover:bg-indigo-600">
                        üìÅ Upload CSV
                    </button>
                    <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
                    <p id="file-status" class="mt-2 text-xs text-gray-500 text-center">No file loaded</p>
                </div>

                <button id="generate-button" class="btn-action">
                    ‚ú® Generate Cloud
                </button>
            </div>
        </div>

        <div id="save-toolbar" class="flex justify-end mt-4 mb-2 opacity-50 pointer-events-none transition-opacity duration-300">
            <button id="save-image-btn" class="px-6 py-2 bg-orange-500 text-white font-bold rounded-xl shadow-md hover:bg-orange-600 transition flex items-center gap-2">
                ‚¨áÔ∏è Save Image
            </button>
        </div>
        
        <div id="word-cloud-wrapper">
            <div id="word-cloud">
                <div class="h-full flex items-center justify-center">
                    <p class="text-gray-300 text-2xl font-bold">Words will appear here...</p>
                </div>
            </div>
        </div>
        
        <div id="message-box" class="fixed bottom-6 right-6 p-4 rounded-xl text-white font-bold shadow-2xl hidden transition duration-300 z-50"></div>

    </div>

    <script>
        // --- CONFIGURATION ---
        const FIXED_FONT_SIZE = 24; // All words will be this size (pixels)
        const COLOR_PALETTE = [
            '#00BCD4', '#0097A7', // Cyans
            '#FF9800', '#F57C00', // Oranges
            '#673AB7', '#512DA8', // Purples
            '#E91E63', '#C2185B', // Pinks
            '#4CAF50', '#388E3C'  // Greens
        ];
        
        // --- ELEMENTS ---
        const wordInput = document.getElementById('word-input');
        const fileButton = document.getElementById('file-button');
        const csvFileInput = document.getElementById('csv-file-input');
        const fileStatus = document.getElementById('file-status');
        const generateButton = document.getElementById('generate-button');
        const saveButton = document.getElementById('save-image-btn');
        const saveToolbar = document.getElementById('save-toolbar');
        const wordCloudEl = document.getElementById('word-cloud');
        const messageBox = document.getElementById('message-box');

        let loadedWords = [];

        // --- UTILS ---
        function showMessage(msg, type = 'error') {
            messageBox.textContent = msg;
            messageBox.className = `fixed bottom-6 right-6 p-4 rounded-xl text-white font-bold shadow-2xl z-50 transition duration-300 ${type === 'error' ? 'bg-red-500' : 'bg-green-500'}`;
            messageBox.classList.remove('hidden');
            setTimeout(() => messageBox.classList.add('hidden'), 3000);
        }

        // --- COLLISION LOGIC ---
        function isOverlapping(rect1, rect2) {
            return !(
                rect1.right < rect2.left || 
                rect1.left > rect2.right || 
                rect1.bottom < rect2.top || 
                rect1.top > rect2.bottom
            );
        }

        // --- MAIN GENERATION ---
        function generateCloud(wordList) {
            wordCloudEl.innerHTML = ''; // Clear board
            
            if (wordList.length === 0) return;

            // Randomize order for better distribution since size is uniform
            wordList.sort(() => Math.random() - 0.5);

            const containerW = wordCloudEl.clientWidth;
            const containerH = wordCloudEl.clientHeight;
            const centerX = containerW / 2;
            const centerY = containerH / 2;

            let placedRects = [];
            let wordsPlacedCount = 0;

            wordList.forEach((text, index) => {
                const span = document.createElement('span');
                span.textContent = text;
                span.className = 'cloud-word';
                
                // UNIFORM SIZE
                span.style.fontSize = `${FIXED_FONT_SIZE}px`;
                
                // Random color
                span.style.color = COLOR_PALETTE[index % COLOR_PALETTE.length];
                
                // Initial hidden render to measure
                span.style.opacity = '0';
                wordCloudEl.appendChild(span);

                const width = span.offsetWidth;
                const height = span.offsetHeight;

                // Spiral Search
                let angle = 0;
                let radius = 0;
                let step = 0.5;
                let foundSpot = false;
                let maxSteps = 2500;
                let finalX = 0; 
                let finalY = 0;

                for (let i = 0; i < maxSteps; i++) {
                    finalX = centerX + (radius * Math.cos(angle)) - (width / 2);
                    finalY = centerY + (radius * Math.sin(angle)) - (height / 2);

                    const candidateRect = {
                        left: finalX,
                        top: finalY,
                        right: finalX + width,
                        bottom: finalY + height
                    };

                    // Check Boundaries with padding
                    const padding = 10;
                    if (finalX < padding || finalY < padding || 
                        (finalX + width) > (containerW - padding) || 
                        (finalY + height) > (containerH - padding)) {
                        angle += step;
                        radius += 2;
                        continue;
                    }

                    // Check Collision
                    let collision = false;
                    for (let existing of placedRects) {
                        if (isOverlapping(candidateRect, existing)) {
                            collision = true;
                            break;
                        }
                    }

                    if (!collision) {
                        foundSpot = true;
                        // Add some padding to the stored rect so words don't touch
                        placedRects.push({
                            left: candidateRect.left - 2,
                            top: candidateRect.top - 2,
                            right: candidateRect.right + 2,
                            bottom: candidateRect.bottom + 2
                        }); 
                        break;
                    }

                    angle += 0.5;
                    radius += 4;
                }

                if (foundSpot) {
                    span.style.left = `${finalX}px`;
                    span.style.top = `${finalY}px`;
                    span.style.opacity = '1';
                    wordsPlacedCount++;
                } else {
                    span.remove();
                }
            });

            // Enable Save Button
            saveToolbar.classList.remove('opacity-50', 'pointer-events-none');
            showMessage(`Cloud created! Placed ${wordsPlacedCount} words.`, 'success');
        }

        // --- SAVE IMAGE FUNCTION ---
        saveButton.addEventListener('click', () => {
            showMessage("Generating image... please wait.", "success");
            
            // Use html2canvas to screenshot the div
            html2canvas(document.querySelector("#word-cloud"), {
                backgroundColor: "#ffffff", // Ensure white background
                scale: 2 // High resolution
            }).then(canvas => {
                // Create a temporary link to trigger download
                const link = document.createElement('a');
                link.download = 'my-word-cloud.png';
                link.href = canvas.toDataURL("image/png");
                link.click();
            }).catch(err => {
                console.error(err);
                showMessage("Error saving image.", "error");
            });
        });

        // --- INPUT HANDLERS ---
        generateButton.addEventListener('click', () => {
            const rawText = wordInput.value;
            let words = [];
            
            if (rawText.trim().length > 0) {
                words = rawText.split(/[\n,]/).map(w => w.trim().toUpperCase()).filter(w => w.length > 0);
            } else if (loadedWords.length > 0) {
                words = loadedWords;
            } else {
                return showMessage('Please enter words or load a file.', 'error');
            }

            const uniqueWords = Array.from(new Set(words));
            generateCloud(uniqueWords);
        });

        fileButton.addEventListener('click', () => csvFileInput.click());
        csvFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (evt) => {
                const lines = evt.target.result.split('\n');
                loadedWords = lines.map(l => l.split(',')[0].trim().toUpperCase()).filter(w => w.length > 0);
                fileStatus.textContent = `Loaded ${loadedWords.length} words.`;
                showMessage(`Loaded ${loadedWords.length} words from CSV.`, 'success');
            };
            reader.readAsText(file);
        });

    </script>
</body>
</html>